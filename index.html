<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Flow 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f4f9; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; margin-bottom: 20px; }
        
        h2 { text-align: center; color: #333; margin-bottom: 1.5rem; margin-top: 0; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; color: #666; font-weight: 500; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; transition: border-color 0.3s; }
        input:focus, select:focus { border-color: #007bff; outline: none; }
        
        /* ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚ ÎˆÏƒÎ¿Î´Î¿/ÎˆÎ¾Î¿Î´Î¿ */
        .type-selector { display: flex; gap: 10px; margin-bottom: 1rem; }
        .type-option { flex: 1; padding: 10px; text-align: center; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .type-option.active.income { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .type-option.active.expense { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }

        button.submit-btn { width: 100%; padding: 14px; background-color: #007bff; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        button.submit-btn:hover { background-color: #0056b3; }
        button.submit-btn:disabled { background-color: #ccc; }

        .loader { display: none; text-align: center; margin-top: 10px; color: #007bff; }
        .message { text-align: center; margin-top: 15px; font-weight: bold; display: none; }
        .footer { text-align: center; font-size: 0.8rem; color: #aaa; margin-top: 20px; }

        /* Î£Î¤Î¥Î› Î“Î™Î‘ Î¤Î‘ Î“Î¡Î‘Î¦Î—ÎœÎ‘Î¤Î‘ */
        .stats-wrapper { display: flex; justify-content: space-between; gap: 10px; margin-top: 10px; }
        .stat-box { flex: 1; text-align: center; }
        .stat-title { font-size: 0.9rem; font-weight: bold; color: #555; margin-bottom: 5px; }
        .chart-container { position: relative; height: 120px; width: 100%; display: flex; justify-content: center; }
        .stat-numbers { margin-top: 8px; font-size: 0.8rem; line-height: 1.4; }
        .inc-text { color: #28a745; font-weight: bold; }
        .exp-text { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>

<div class="container" id="dashboard" style="display:none;">
    <h2>ğŸ“Š Î•Î¹ÎºÏŒÎ½Î± Î¤Î±Î¼ÎµÎ¯Î¿Ï…</h2>
    <div class="stats-wrapper">
        <div class="stat-box">
            <div class="stat-title">Î¤ÏÎ­Ï‡Ï‰Î½ ÎœÎ®Î½Î±Ï‚</div>
            <div class="chart-container">
                <canvas id="monthChart"></canvas>
            </div>
            <div class="stat-numbers">
                <div class="inc-text">ÎˆÏƒÎ¿Î´Î±: <span id="m-inc">0â‚¬</span></div>
                <div class="exp-text">ÎˆÎ¾Î¿Î´Î±: <span id="m-exp">0â‚¬</span></div>
            </div>
        </div>
        <div class="stat-box" style="border-left: 1px solid #eee;">
            <div class="stat-title">Î¤ÏÎ­Ï‡Î¿Î½ ÎˆÏ„Î¿Ï‚</div>
            <div class="chart-container">
                <canvas id="yearChart"></canvas>
            </div>
            <div class="stat-numbers">
                <div class="inc-text">ÎˆÏƒÎ¿Î´Î±: <span id="y-inc">0â‚¬</span></div>
                <div class="exp-text">ÎˆÎ¾Î¿Î´Î±: <span id="y-exp">0â‚¬</span></div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <h2>ğŸ’¸ ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</h2>
    <form id="cashForm">
        
        <div class="type-selector">
            <div class="type-option active expense" id="btn-expense" onclick="setType('ÎˆÎ¾Î¿Î´Î¿')">ÎˆÎ¾Î¿Î´Î¿</div>
            <div class="type-option" id="btn-income" onclick="setType('ÎˆÏƒÎ¿Î´Î¿')">ÎˆÏƒÎ¿Î´Î¿</div>
        </div>
        <input type="hidden" id="type" name="type" value="ÎˆÎ¾Î¿Î´Î¿">

        <div class="form-group">
            <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</label>
            <input type="date" id="date" required>
        </div>

        <div class="form-group">
            <label>Î Î¿ÏƒÏŒ (â‚¬)</label>
            <input type="number" id="amount" step="0.01" placeholder="0.00" required inputmode="decimal">
        </div>

        <div class="form-group">
            <label>Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î± / ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</label>
            <input list="categoryList" id="category" name="category" placeholder="Î•Ï€Î¯Î»ÎµÎ¾Îµ Î® Î³ÏÎ¬ÏˆÎµ..." required autocomplete="off">
            <datalist id="categoryList">
                <option value="Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...">
            </datalist>
        </div>

        <div class="form-group">
            <label>Î¤ÏÎ¬Ï€ÎµÎ¶Î± / ÎœÎ­ÏƒÎ¿ Î Î»Î·ÏÏ‰Î¼Î®Ï‚</label>
            <select id="bank" required>
                <option value="" disabled selected>Î•Ï€Î¯Î»ÎµÎ¾Îµ Î¤ÏÎ¬Ï€ÎµÎ¶Î±</option>
                <option value="Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</option>
            </select>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</button>
        <div class="loader" id="loader">Î“Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...</div>
        <div class="message" id="message"></div>
    </form>
    <div class="footer">Connected to Sheet: 2026</div>
</div>

<script>
    // Î¤ÎŸ ÎÎ•ÎŸ URL Î£ÎŸÎ¥:
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwLiuMxXPBIaoXf6h7EEfeNiHtru5B7HheDDhK9tq-TObfQ0R_6VbDnfKNcdQiELsgsTA/exec";

    document.getElementById('date').valueAsDate = new Date();

    function setType(val) {
        document.getElementById('type').value = val;
        if(val === 'ÎˆÏƒÎ¿Î´Î¿') {
            document.getElementById('btn-income').classList.add('active', 'income');
            document.getElementById('btn-expense').classList.remove('active', 'expense');
        } else {
            document.getElementById('btn-expense').classList.add('active', 'expense');
            document.getElementById('btn-income').classList.remove('active', 'income');
        }
    }

    // Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î½Î¿Î¼Î¯ÏƒÎ¼Î±Ï„Î¿Ï‚
    function formatMoney(amount) {
        return Number(amount).toLocaleString('el-GR', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 });
    }

    // Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚
    function createChart(ctx, income, expense) {
        return new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['ÎˆÏƒÎ¿Î´Î±', 'ÎˆÎ¾Î¿Î´Î±'],
                datasets: [{
                    data: [income, expense],
                    backgroundColor: ['#28a745', '#dc3545'], // Î ÏÎ¬ÏƒÎ¹Î½Î¿ - ÎšÏŒÎºÎºÎ¹Î½Î¿
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '65%', // Î Î¬Ï‡Î¿Ï‚ Î´Î±ÎºÏ„Ï…Î»Î¯Î¿Ï…
                plugins: { legend: { display: false } }
            }
        });
    }

    window.onload = function() {
        console.log("Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...");
        fetch(SCRIPT_URL)
            .then(response => response.json())
            .then(data => {
                console.log("Î›Î®Ï†Î¸Î·ÎºÎ±Î½:", data);
                
                // --- 1. Î“Î­Î¼Î¹ÏƒÎ¼Î± Î»Î¹ÏƒÏ„ÏÎ½ (ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ / Î¤ÏÎ¬Ï€ÎµÎ¶ÎµÏ‚) ---
                const catList = document.getElementById('categoryList');
                catList.innerHTML = ''; 
                if (data.categories && data.categories.length > 0) {
                    data.categories.forEach(cat => {
                        let option = document.createElement('option');
                        option.value = cat;
                        catList.appendChild(option);
                    });
                }

                const bankSelect = document.getElementById('bank');
                bankSelect.innerHTML = '<option value="" disabled selected>Î•Ï€Î¯Î»ÎµÎ¾Îµ Î¤ÏÎ¬Ï€ÎµÎ¶Î±</option>';
                if (data.banks && data.banks.length > 0) {
                    data.banks.forEach(bank => {
                        let option = document.createElement('option');
                        option.value = bank;
                        option.text = bank;
                        bankSelect.appendChild(option);
                    });
                }

                // --- 2. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½ & Î“ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½ ---
                if (data.stats) {
                    document.getElementById('dashboard').style.display = 'block';

                    // ÎœÎ·Î½Î¹Î±Î¯Î±
                    document.getElementById('m-inc').innerText = formatMoney(data.stats.month.income);
                    document.getElementById('m-exp').innerText = formatMoney(data.stats.month.expense);
                    createChart(document.getElementById('monthChart'), data.stats.month.income, data.stats.month.expense);

                    // Î•Ï„Î®ÏƒÎ¹Î±
                    document.getElementById('y-inc').innerText = formatMoney(data.stats.year.income);
                    document.getElementById('y-exp').innerText = formatMoney(data.stats.year.expense);
                    createChart(document.getElementById('yearChart'), data.stats.year.income, data.stats.year.expense);
                }

            })
            .catch(error => {
                console.error('Error loading lists:', error);
                document.getElementById('bank').innerHTML = '<option value="ÎœÎµÏ„ÏÎ·Ï„Î¬">ÎœÎµÏ„ÏÎ·Ï„Î¬ (Offline mode)</option>';
            });
    };

    document.getElementById('cashForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submitBtn');
        const loader = document.getElementById('loader');
        const message = document.getElementById('message');
        
        submitBtn.disabled = true;
        submitBtn.innerText = "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®...";
        loader.style.display = 'block';
        message.style.display = 'none';

        const formData = {
            date: document.getElementById('date').value,
            amount: document.getElementById('amount').value,
            category: document.getElementById('category').value,
            bank: document.getElementById('bank').value,
            type: document.getElementById('type').value
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            loader.style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.innerText = "ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·";
            
            if(data.status === 'success') {
                message.innerText = "âœ… Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±!";
                message.style.color = "green";
                message.style.display = "block";
                
                document.getElementById('amount').value = '';
                document.getElementById('category').value = '';
                document.getElementById('date').valueAsDate = new Date(); 
                
                setTimeout(() => {
                    message.style.display = 'none';
                    // Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬: ÎÎ±Î½Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎµ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± Î½Î± ÎµÎ½Î·Î¼ÎµÏÏ‰Î¸Î¿ÏÎ½ Ï„Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î±
                    // window.location.reload(); 
                }, 2000);

            } else {
                throw new Error(data.message || "Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±");
            }
        })
        .catch(error => {
            loader.style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.innerText = "ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·";
            message.innerText = "âŒ Î£Ï†Î¬Î»Î¼Î±: " + error.message;
            message.style.color = "red";
            message.style.display = "block";
        });
    });
</script>

</body>
</html>
