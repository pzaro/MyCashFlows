<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Flow 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f9; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; margin-bottom: 20px; }
        h2 { text-align: center; color: #333; margin-bottom: 1rem; font-size: 1.2rem; }
        .form-group { margin-bottom: 1rem; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        
        .type-selector { display: flex; gap: 10px; margin-bottom: 1rem; }
        .type-option { flex: 1; padding: 10px; text-align: center; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .type-option.active.income { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .type-option.active.expense { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        
        button.submit-btn { width: 100%; padding: 14px; background-color: #007bff; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
        
        /* Î£Î¤Î‘Î¤Î™Î£Î¤Î™ÎšÎ‘ */
        .stat-box { background: #fff; padding: 15px; border-radius: 10px; margin-top: 10px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .chart-container { position: relative; height: 100px; width: 100%; }
        .stat-numbers { display: flex; flex-direction: column; gap: 5px; margin-top: 10px; font-size: 0.95rem; border-top: 1px solid #eee; padding-top: 10px; }
        .inc { color: #28a745; font-weight: bold; display: flex; justify-content: space-between; }
        .exp { color: #dc3545; font-weight: bold; display: flex; justify-content: space-between; }
        .bal { color: #333; font-weight: bold; display: flex; justify-content: space-between; border-top: 1px dashed #ccc; padding-top: 5px; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ’¸ ÎÎ­Î± ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</h2>
    <form id="cashForm">
        <div class="type-selector">
            <div class="type-option active expense" id="btn-expense" onclick="setType('ÎˆÎ¾Î¿Î´Î¿')">ÎˆÎ¾Î¿Î´Î¿</div>
            <div class="type-option" id="btn-income" onclick="setType('ÎˆÏƒÎ¿Î´Î¿')">ÎˆÏƒÎ¿Î´Î¿</div>
        </div>
        <input type="hidden" id="type" value="ÎˆÎ¾Î¿Î´Î¿">
        <div class="form-group"><input type="date" id="date" required></div>
        <div class="form-group"><input type="number" id="amount" step="0.01" placeholder="Î Î¿ÏƒÏŒ (â‚¬)" required inputmode="decimal"></div>
        <div class="form-group"><input list="categoryList" id="category" placeholder="ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±" required><datalist id="categoryList"></datalist></div>
        <div class="form-group"><select id="bank" required><option value="" disabled selected>Î¤ÏÎ¬Ï€ÎµÎ¶Î±</option></select></div>
        <button type="submit" class="submit-btn" id="submitBtn">ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</button>
    </form>
</div>

<div class="container" id="dashboard">
    <h2>ğŸ“Š ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ® Î•Î¹ÎºÏŒÎ½Î±</h2>
    
    <div class="stat-box">
        <div style="font-weight:bold; font-size:0.9rem; margin-bottom:10px; color:#555;">Î‘Î¥Î¤ÎŸÎ£ ÎŸ ÎœÎ—ÎÎ‘Î£</div>
        <div class="chart-container"><canvas id="monthChart"></canvas></div>
        <div class="stat-numbers">
            <div class="inc"><span>ÎˆÏƒÎ¿Î´Î±:</span> <span id="m-inc">0â‚¬</span></div>
            <div class="exp"><span>ÎˆÎ¾Î¿Î´Î±:</span> <span id="m-exp">0â‚¬</span></div>
            <div class="bal"><span>Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿:</span> <span id="m-bal">0â‚¬</span></div>
        </div>
    </div>

    <div class="stat-box">
        <div style="font-weight:bold; font-size:0.9rem; margin-bottom:10px; color:#555;">Î£Î¥ÎÎŸÎ›ÎŸ Î•Î¤ÎŸÎ¥Î£ 2026</div>
        <div class="chart-container"><canvas id="yearChart"></canvas></div>
        <div class="stat-numbers">
            <div class="inc"><span>ÎˆÏƒÎ¿Î´Î±:</span> <span id="y-inc">0â‚¬</span></div>
            <div class="exp"><span>ÎˆÎ¾Î¿Î´Î±:</span> <span id="y-exp">0â‚¬</span></div>
            <div class="bal"><span>Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿:</span> <span id="y-bal">0â‚¬</span></div>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxesQmJ3vIe75RuFvtWbPC9PwE2dF6ufuEWgCcYZHb9hIk-QyUZEa4plnTKtdsTq9nsTQ/exec";

    let chartM, chartY;
    document.getElementById('date').valueAsDate = new Date();

    function setType(v) {
        document.getElementById('type').value = v;
        document.getElementById('btn-income').className = 'type-option' + (v==='ÎˆÏƒÎ¿Î´Î¿'?' active income':'');
        document.getElementById('btn-expense').className = 'type-option' + (v==='ÎˆÎ¾Î¿Î´Î¿'?' active expense':'');
    }

    function drawBarChart(canvasId, income, expense) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        return new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['ÎˆÏƒÎ¿Î´Î±', 'ÎˆÎ¾Î¿Î´Î±'],
                datasets: [{
                    data: [income, expense],
                    backgroundColor: ['#28a745', '#dc3545'],
                    borderRadius: 5,
                    barThickness: 20
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Ï„Î¹Î¼Î®Ï‚ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î·Î½ Î¼Ï€Î¬ÏÎ±
                    tooltip: { enabled: true }
                },
                scales: {
                    x: { beginAtZero: true, grid: { display: false }, ticks: { display: false } },
                    y: { grid: { display: false }, ticks: { font: { weight: 'bold' } } }
                }
            }
        });
    }

    function loadData() {
        fetch(SCRIPT_URL).then(r => r.json()).then(data => {
            document.getElementById('categoryList').innerHTML = data.categories.map(c => `<option value="${c}">`).join('');
            const bSel = document.getElementById('bank');
            const currentVal = bSel.value;
            bSel.innerHTML = '<option value="" disabled selected>Î¤ÏÎ¬Ï€ÎµÎ¶Î±</option>' + 
                             data.banks.map(b => `<option value="${b}">${b}</option>`).join('');
            if(currentVal) bSel.value = currentVal;

            // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î±ÏÎ¹Î¸Î¼ÏÎ½ ÎœÎ®Î½Î±
            document.getElementById('m-inc').innerText = data.stats.month.income.toFixed(2) + "â‚¬";
            document.getElementById('m-exp').innerText = data.stats.month.expense.toFixed(2) + "â‚¬";
            document.getElementById('m-bal').innerText = (data.stats.month.income - data.stats.month.expense).toFixed(2) + "â‚¬";

            // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î±ÏÎ¹Î¸Î¼ÏÎ½ ÎˆÏ„Î¿Ï…Ï‚
            document.getElementById('y-inc').innerText = data.stats.year.income.toFixed(2) + "â‚¬";
            document.getElementById('y-exp').innerText = data.stats.year.expense.toFixed(2) + "â‚¬";
            document.getElementById('y-bal').innerText = (data.stats.year.income - data.stats.year.expense).toFixed(2) + "â‚¬";

            if(chartM) chartM.destroy();
            if(chartY) chartY.destroy();
            chartM = drawBarChart('monthChart', data.stats.month.income, data.stats.month.expense);
            chartY = drawBarChart('yearChart', data.stats.year.income, data.stats.year.expense);
        });
    }

    window.onload = loadData;

    document.getElementById('cashForm').onsubmit = function(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.disabled = true; btn.innerText = "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...";
        
        fetch(SCRIPT_URL, { 
            method: 'POST', 
            body: JSON.stringify({
                date: document.getElementById('date').value,
                amount: document.getElementById('amount').value,
                category: document.getElementById('category').value,
                bank: document.getElementById('bank').value,
                type: document.getElementById('type').value
            })
        }).then(() => {
            btn.disabled = false; btn.innerText = "ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·";
            document.getElementById('amount').value = '';
            loadData();
        });
    };
</script>
</body>
</html>
