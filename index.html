<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Manager 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        .container { background: white; padding: 1.2rem; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 100%; max-width: 420px; margin-bottom: 15px; box-sizing: border-box; position: relative; }
        h2 { text-align: center; color: #1a1a1a; font-size: 1rem; border-bottom: 2px solid #f0f0f0; padding-bottom: 8px; margin-top: 0; }
        .type-selector { display: flex; gap: 10px; margin-bottom: 15px; }
        .type-btn { flex: 1; padding: 12px; border-radius: 10px; border: 2px solid #ddd; background: white; cursor: pointer; font-weight: bold; transition: 0.3s; text-align: center; }
        .active-income { background-color: #28a745; color: white; border-color: #28a745; }
        .active-expense { background-color: #dc3545; color: white; border-color: #dc3545; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        .submit-btn { width: 100%; padding: 14px; background-color: #007bff; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .lock-btn { background-color: #6c757d; font-size: 0.8rem; padding: 5px 10px; border-radius: 5px; color: white; border: none; cursor: pointer; float: right; }
        .stat-box { background: #fff; padding: 12px; border-radius: 12px; border: 1px solid #eee; margin-top: 10px; }
        .chart-container { position: relative; height: 110px; width: 100%; }
        .pie-container { position: relative; height: 220px; width: 100%; }
        #privateSection { display: none; border-top: 3px solid #dc3545; padding-top: 15px; margin-top: 10px; clear: both; }
        .balance-row { display: flex; justify-content: space-between; font-size: 0.8rem; padding: 6px 0; border-bottom: 1px solid #f1f1f1; }
        .diff-up { color: #28a745; font-weight: bold; }
        .diff-down { color: #dc3545; font-weight: bold; }
        .total-val { text-align: center; font-size: 1.3rem; font-weight: bold; color: #dc3545; margin: 10px 0; }
        .bal-input-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 0.75rem; }
        .bal-input-row input { width: 110px; padding: 6px; text-align: right; border-radius: 6px; border: 1px solid #ddd; }
        .toggle-link { color: #007bff; font-size: 0.8rem; cursor: pointer; text-decoration: underline; font-weight: bold; }
        #yearSection { display: none; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ’¸ ÎÎ­Î± ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</h2>
    <div class="type-selector">
        <div id="btnExpense" class="type-btn active-expense" onclick="setType('ÎˆÎ¾Î¿Î´Î¿')">Î•ÎÎŸÎ”ÎŸ</div>
        <div id="btnIncome" class="type-btn" onclick="setType('ÎˆÏƒÎ¿Î´Î¿')">Î•Î£ÎŸÎ”ÎŸ</div>
    </div>
    <form id="cashForm">
        <input type="date" id="date" required style="margin-bottom:10px;">
        <input type="text" id="amount" placeholder="Î Î¿ÏƒÏŒ â‚¬" required style="margin-bottom:10px;" inputmode="decimal">
        <input list="categoryList" id="category" placeholder="Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±" required style="margin-bottom:10px;"><datalist id="categoryList"></datalist>
        <select id="bank" required style="margin-bottom:10px;"><option value="" disabled selected>Î¤ÏÎ¬Ï€ÎµÎ¶Î±</option></select>
        <button type="submit" class="submit-btn" id="submitBtn">ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</button>
    </form>
</div>

<div class="container">
    <h2>ğŸ“Š Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬ 2026 <span class="toggle-link" onclick="toggleSection('yearSection')">+/- ÎˆÏ„Î¿Ï‚</span></h2>
    <div class="stat-box"><div style="font-size: 0.7rem; font-weight: bold;">Î£Î—ÎœÎ•Î¡Î‘</div><div class="chart-container"><canvas id="dayChart"></canvas></div></div>
    <div class="stat-box"><div style="font-size: 0.7rem; font-weight: bold;">Î•Î’Î”ÎŸÎœÎ‘Î”Î‘</div><div class="chart-container"><canvas id="weekChart"></canvas></div></div>
    <div class="stat-box"><div style="font-size: 0.7rem; font-weight: bold;">ÎœÎ—ÎÎ‘Î£</div><div class="chart-container"><canvas id="monthChart"></canvas></div></div>
    <div id="yearSection"><div class="stat-box"><div style="font-size: 0.7rem; font-weight: bold;">Î•Î¤ÎŸÎ£</div><div class="chart-container"><canvas id="yearChart"></canvas></div></div></div>
</div>

<div class="container">
    <button class="lock-btn" id="lockBtn" onclick="handleLock()">Unlock</button>
    <h2 style="text-align:left;">ğŸ”’ Balance</h2>
    <div id="privateSection">
        <div class="form-group"><label style="font-size:0.8rem; font-weight:bold;">Î•Î Î™Î›ÎŸÎ“Î— ÎœÎ—ÎÎ‘:</label><select id="balMonth" onchange="refreshPrivateUI()"></select></div>
        <div class="total-val" id="totalLabel">0â‚¬</div>
        <div class="stat-box"><div class="pie-container"><canvas id="pieChart"></canvas></div><div id="diffList" style="margin-top:15px;"></div></div>
        <div class="stat-box" style="background: #fafafa; border: 1px dashed #ccc;"><div style="font-weight:bold; font-size:0.8rem; margin-bottom:10px;">Î•ÎÎ—ÎœÎ•Î¡Î©Î£Î— Î£Î¤Î—Î›Î—Î£</div><div id="balInputs"></div><button onclick="saveBal()" id="balBtn" class="submit-btn" style="background:#28a745;">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button></div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz_doscJ4Lbv2ccXUZJsMJ1WMMA0vHui6BSGEo00olQVzN0UZG4VopQPUq6D8FnBdQU3w/exec";
    let chartM, chartY, chartP, chartD, chartW;
    let isLocked = true, lastData = null, currentType = 'ÎˆÎ¾Î¿Î´Î¿';

    function setType(t) { currentType = t; document.getElementById('btnIncome').classList.toggle('active-income', t==='ÎˆÏƒÎ¿Î´Î¿'); document.getElementById('btnExpense').classList.toggle('active-expense', t==='ÎˆÎ¾Î¿Î´Î¿'); }
    function parseGreekFloat(v) { return parseFloat(v.toString().replace(',', '.')) || 0; }
    function toggleSection(id) { const el = document.getElementById(id); el.style.display = (el.style.display==='block')?'none':'block'; }

    function handleLock() {
        if (isLocked) { if (prompt("ÎšÏ‰Î´Î¹ÎºÏŒÏ‚:") === "1234") { isLocked = false; document.getElementById('privateSection').style.display = 'block'; document.getElementById('lockBtn').innerText = "Lock ğŸ”’"; document.getElementById('lockBtn').style.background = "#dc3545"; refreshPrivateUI(); }
        } else { isLocked = true; document.getElementById('privateSection').style.display = 'none'; document.getElementById('lockBtn').innerText = "Unlock"; document.getElementById('lockBtn').style.background = "#6c757d"; }
    }

    function refreshPrivateUI() {
        if(!lastData || isLocked) return;
        const mIdx = parseInt(document.getElementById('balMonth').value), colIdx = mIdx + 2, pColIdx = colIdx - 1;
        let cVals = [], pVals = [], labels = [], total = 0;
        lastData.fullBalance.forEach(row => { labels.push(row[0]); const c = parseFloat(row[colIdx])||0, p = parseFloat(row[pColIdx])||0; cVals.push(c); pVals.push(p); total += c; });
        document.getElementById('totalLabel').innerText = total.toLocaleString() + "â‚¬";
        if(chartP) chartP.destroy();
        chartP = new Chart(document.getElementById('pieChart'), { type: 'doughnut', data: { labels: labels, datasets: [{ data: cVals, backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#8AC926','#1982C4','#6A4C93','#F15BB5','#FEE440','#00BBF9','#00F5D4','#9B5DE5'] }] }, options: { responsive: true, maintainAspectRatio: false } });
        document.getElementById('diffList').innerHTML = labels.map((n, i) => { const d = cVals[i]-pVals[i], cl = d>0?'diff-up':d<0?'diff-down':''; return `<div class="balance-row"><span>${n}</span><span class="${cl}">${d>0?'â–²':d<0?'â–¼':'â€¢'} ${Math.abs(d).toLocaleString()}â‚¬</span></div>`; }).join('');
        document.getElementById('balInputs').innerHTML = labels.map((n, i) => `<div class="bal-input-row"><span>${n}</span><input type="text" class="bal-val" value="${cVals[i]===0?'':cVals[i].toString().replace('.',',')}" placeholder="0,00" inputmode="decimal"></div>`).join('');
    }

    function loadData() {
        fetch(SCRIPT_URL).then(r => r.json()).then(data => {
            lastData = data;
            document.getElementById('categoryList').innerHTML = data.categories.map(c => `<option value="${c}">`).join('');
            document.getElementById('bank').innerHTML = '<option value="" disabled selected>Î¤ÏÎ¬Ï€ÎµÎ¶Î±</option>' + data.banks.map(b => `<option value="${b}">${b}</option>`).join('');
            const mSel = document.getElementById('balMonth');
            if(mSel.options.length === 0) { const ms = ["Î™Î‘ÎÎŸÎ¥Î‘Î¡Î™ÎŸÎ£", "Î¦Î•Î’Î¡ÎŸÎ¥Î‘Î¡Î™ÎŸÎ£", "ÎœÎ‘Î¡Î¤Î™ÎŸÎ£", "Î‘Î Î¡Î™Î›Î™ÎŸÎ£", "ÎœÎ‘ÎªÎŸÎ£", "Î™ÎŸÎ¥ÎÎ™ÎŸÎ£", "Î™ÎŸÎ¥Î›Î™ÎŸÎ£", "Î‘Î¥Î“ÎŸÎ¥Î£Î¤ÎŸÎ£", "Î£Î•Î Î¤Î•ÎœÎ’Î¡Î™ÎŸÎ£", "ÎŸÎšÎ¤Î©Î’Î¡Î™ÎŸÎ£", "ÎÎŸÎ•ÎœÎ’Î¡Î™ÎŸÎ£", "Î”Î•ÎšÎ•ÎœÎ’Î¡Î™ÎŸÎ£"]; mSel.innerHTML = ms.map((m, i) => `<option value="${i}">${m}</option>`).join(''); mSel.value = new Date().getMonth(); }
            if(chartD) chartD.destroy(); chartD = drawBar('dayChart', data.stats.day.income, data.stats.day.expense);
            if(chartW) chartW.destroy(); chartW = drawBar('weekChart', data.stats.week.income, data.stats.week.expense);
            if(chartM) chartM.destroy(); chartM = drawBar('monthChart', data.stats.month.income, data.stats.month.expense);
            if(chartY) chartY.destroy(); chartY = drawBar('yearChart', data.stats.year.income, data.stats.year.expense);
            if(!isLocked) refreshPrivateUI();
        });
    }

    function drawBar(id, inc, exp) { return new Chart(document.getElementById(id), { type: 'bar', data: { labels: ['ÎˆÏƒÎ¿Î´Î±', 'ÎˆÎ¾Î¿Î´Î±'], datasets: [{ data: [inc, exp], backgroundColor: ['#28a745', '#dc3545'] }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } }); }
    function saveBal() { const btn = document.getElementById('balBtn'); btn.disabled = true; const vs = Array.from(document.getElementsByClassName('bal-val')).map(i => parseGreekFloat(i.value)); fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "updateBalance", monthIndex: document.getElementById('balMonth').value, values: vs }) }).then(() => { alert("Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!"); loadData(); btn.disabled = false; }); }

    window.onload = loadData;
    document.getElementById('date').valueAsDate = new Date();
    document.getElementById('cashForm').onsubmit = function(e) { e.preventDefault(); const btn = document.getElementById('submitBtn'); btn.disabled = true; fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ date: document.getElementById('date').value, amount: parseGreekFloat(document.getElementById('amount').value), category: document.getElementById('category').value, bank: document.getElementById('bank').value, type: currentType }) }).then(() => { document.getElementById('amount').value = ''; btn.disabled = false; loadData(); }); };
</script>
</body>
</html>

