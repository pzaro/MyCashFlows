<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance App</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        .container { background: white; padding: 1.2rem; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 100%; max-width: 400px; margin-bottom: 15px; position: relative; }
        h2 { text-align: center; color: #333; font-size: 1rem; border-bottom: 2px solid #f0f0f0; padding-bottom: 8px; }
        .form-group { margin-bottom: 0.8rem; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .type-selector { display: flex; gap: 8px; margin-bottom: 1rem; }
        .type-option { flex: 1; padding: 10px; text-align: center; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .active.income { background-color: #d4edda; color: #155724; }
        .active.expense { background-color: #f8d7da; color: #721c24; }
        button.submit-btn { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .settings-icon { position: absolute; top: 15px; right: 15px; cursor: pointer; font-size: 1.2rem; opacity: 0.2; }
        
        /* ÎšÏÏ…Ï†ÏŒ Dashboard */
        #privateDashboard { display: none; margin-top: 15px; border-top: 3px solid #007bff; padding-top: 15px; }
        .stat-box { background: #fff; padding: 10px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #eee; }
        .chart-container { position: relative; height: 110px; }
        .balance-row { display: flex; justify-content: space-between; font-size: 0.7rem; padding: 4px 0; border-bottom: 1px solid #f9f9f9; }
        .diff-up { color: green; font-weight: bold; }
        .diff-down { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <span class="settings-icon" onclick="unlock()">âš™ï¸</span>
    <h2>ğŸ’¸ ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</h2>
    <form id="cashForm">
        <div class="type-selector">
            <div class="type-option active expense" id="btn-expense" onclick="setType('ÎˆÎ¾Î¿Î´Î¿')">ÎˆÎ¾Î¿Î´Î¿</div>
            <div class="type-option" id="btn-income" onclick="setType('ÎˆÏƒÎ¿Î´Î¿')">ÎˆÏƒÎ¿Î´Î¿</div>
        </div>
        <input type="hidden" id="type" value="ÎˆÎ¾Î¿Î´Î¿">
        <div class="form-group"><input type="date" id="date" required></div>
        <div class="form-group"><input type="number" id="amount" step="0.01" placeholder="Î Î¿ÏƒÏŒ â‚¬" required></div>
        <div class="form-group"><input list="categoryList" id="category" placeholder="Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±" required><datalist id="categoryList"></datalist></div>
        <div class="form-group"><select id="bank" required><option value="" disabled selected>Î¤ÏÎ¬Ï€ÎµÎ¶Î±</option></select></div>
        <button type="submit" class="submit-btn">ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</button>
    </form>

    <div id="privateDashboard">
        <h2>ğŸ¦ Î™Î´Î¹Ï‰Ï„Î¹ÎºÏŒ Dashboard</h2>
        
        <div class="stat-box">
            <canvas id="pieChart" style="max-height: 180px;"></canvas>
            <div id="totalBal" style="text-align:center; font-weight:bold; color:#007bff; margin-top:10px;"></div>
        </div>

        <div class="stat-box">
            <div style="font-size: 0.75rem; font-weight: bold; margin-bottom: 8px;">Î”Î™Î‘ÎšÎ¥ÎœÎ‘ÎÎ£Î— Î‘ÎÎ‘ ÎšÎ©Î”Î™ÎšÎŸ</div>
            <div id="diffList"></div>
        </div>

        <div class="stat-box">
            <select id="balMonth" style="margin-bottom:10px;"><option value="0">Î™Î‘Î</option><option value="1">Î¦Î•Î’</option><option value="2">ÎœÎ‘Î¡</option><option value="3">Î‘Î Î¡</option><option value="4">ÎœÎ‘Îª</option><option value="5">Î™ÎŸÎ¥Î</option><option value="6">Î™ÎŸÎ¥Î›</option><option value="7">Î‘Î¥Î“</option><option value="8">Î£Î•Î </option><option value="9">ÎŸÎšÎ¤</option><option value="10">ÎÎŸÎ•</option><option value="11">Î”Î•Îš</option></select>
            <div id="balInputs"></div>
            <button onclick="saveBal()" id="balBtn" class="submit-btn" style="background:#28a745;">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
        </div>
    </div>
</div>

<div class="container">
    <h2>ğŸ“Š Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬ ÎœÎ®Î½Î±</h2>
    <div class="chart-container"><canvas id="monthChart"></canvas></div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyOjfjaSn36dbrduHC01hxrnM2GuWWjnLbI4mrFtnu0yWTlh1Ud6hoFdu9eRLSrB9ilqA/exec";
    let chartM, chartP;
    const accounts = ["Î‘Î¤Î¤Î™ÎšÎ—Î£ Î Î¡ÎŸÎ˜Î•Î£ÎœÎ™Î‘ÎšÎ— Î Î‘ÎÎŸÎ£", "Î‘Î¤Î¤Î™ÎšÎ—Î£ CREDIA TARGET MATURITY", "Î‘Î¤Î¤Î™ÎšÎ—Î£ Î‘ÎÎŸÎ™Î§Î¤ÎŸÎ£", "Î Î•Î™Î¡Î‘Î™Î©Î£ BUSSINES", "EUROBANK Î‘ÎÎŸÎ™Î§Î¤ÎŸ Î Î‘ÎÎŸÎ£", "Î•Î Î™Î¤Î‘Î“Î•Î£", "Î‘ÎÎŸÎ™Î§Î¤Î‘ Î¥Î ÎŸÎ›ÎŸÎ™Î Î‘ Î Î•Î›Î‘Î¤Î©Î", "Î‘Î¤Î¤Î™ÎšÎ—Î£ Î Î¡ÎŸÎ˜Î•Î£ÎœÎ™Î‘ÎšÎ— Î›Î™Î‘", "PRONTI", "EUROBANK Î Î¡ÎŸÎ˜Î•Î£ÎœÎ™Î‘ÎšÎ— Î›Î™Î‘", "EUROBANK", "EUROBANK Î‘ÎÎŸÎ™Î§Î¤ÎŸÎ£ Î›Î™Î‘", "REVOLUT", "Î Î•Î™Î¡Î‘Î™Î©Î£ BUSSINES ÎœÎ•Î¤ÎŸÎ§Î•Î£", "CASA", "VACANZE"];

    function setType(v) { document.getElementById('type').value = v; document.getElementById('btn-income').className = 'type-option' + (v==='ÎˆÏƒÎ¿Î´Î¿'?' active income':''); document.getElementById('btn-expense').className = 'type-option' + (v==='ÎˆÎ¾Î¿Î´Î¿'?' active expense':''); }

    function unlock() {
        if(prompt("ÎšÏ‰Î´Î¹ÎºÏŒÏ‚:") === "1234") {
            document.getElementById('privateDashboard').style.display = 'block';
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
    }

    function loadData() {
        fetch(SCRIPT_URL).then(r => r.json()).then(data => {
            document.getElementById('categoryList').innerHTML = data.categories.map(c => `<option value="${c}">`).join('');
            document.getElementById('bank').innerHTML = '<option value="" disabled selected>Î¤ÏÎ¬Ï€ÎµÎ¶Î±</option>' + data.banks.map(b => `<option value="${b}">${b}</option>`).join('');
            
            // Î“ÏÎ¬Ï†Î·Î¼Î± ÎœÎ®Î½Î± (Î¦Î±Î¯Î½ÎµÏ„Î±Î¹ Ï€Î¬Î½Ï„Î±)
            if(chartM) chartM.destroy();
            chartM = new Chart(document.getElementById('monthChart'), { type: 'bar', data: { labels: ['ÎˆÏƒÎ¿Î´Î±', 'ÎˆÎ¾Î¿Î´Î±'], datasets: [{ data: [data.stats.month.income, data.stats.month.expense], backgroundColor: ['#28a745', '#dc3545'] }] }, options: { indexAxis: 'y', plugins: { legend: { display: false } } } });

            // ÎšÏÏ…Ï†ÏŒ Balance
            document.getElementById('totalBal').innerText = "Î£Î¥ÎÎŸÎ›ÎŸ Î Î•Î¡Î™ÎŸÎ¥Î£Î™Î‘Î£: " + data.balanceData.total.toLocaleString() + "â‚¬";
            if(chartP) chartP.destroy();
            chartP = new Chart(document.getElementById('pieChart'), { type: 'doughnut', data: { labels: data.balanceData.labels, datasets: [{ data: data.balanceData.currentValues, backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#8AC926','#1982C4','#6A4C93','#F15BB5','#FEE440','#00BBF9','#00F5D4','#9B5DE5','#F15BB5','#EE6C4D'] }] } });

            // Î›Î¯ÏƒÏ„Î± Î‘Ï…Î¾Î¿Î¼ÎµÎ¹ÏÏƒÎµÏ‰Î½
            let listHtml = "";
            data.balanceData.labels.forEach((name, i) => {
                const diff = data.balanceData.diffs[i];
                const diffClass = diff > 0 ? 'diff-up' : (diff < 0 ? 'diff-down' : '');
                const diffText = diff > 0 ? `+${diff.toLocaleString()}â‚¬` : (diff < 0 ? `${diff.toLocaleString()}â‚¬` : '0â‚¬');
                listHtml += `<div class="balance-row"><span>${name}</span><span class="${diffClass}">${diffText}</span></div>`;
            });
            document.getElementById('diffList').innerHTML = listHtml;

            // Inputs Î³Î¹Î± Update
            document.getElementById('balInputs').innerHTML = data.balanceData.labels.map((name, i) => `<div class="balance-item" style="display:flex; justify-content:space-between; font-size:0.7rem; margin-bottom:4px;"><span>${name.substring(0,18)}</span><input type="number" class="bal-val" value="${data.balanceData.currentValues[i]}" style="width:40%; padding:3px;"></div>`).join('');
        });
    }

    function saveBal() {
        const btn = document.getElementById('balBtn');
        btn.disabled = true; btn.innerText = "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...";
        const vals = Array.from(document.getElementsByClassName('bal-val')).map(i => parseFloat(i.value) || 0);
        fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "updateBalance", monthIndex: document.getElementById('balMonth').value, values: vals }) }).then(() => { alert("Î•Î½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ!"); loadData(); btn.disabled = false; btn.innerText = "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·"; });
    }

    window.onload = loadData;
    document.getElementById('cashForm').onsubmit = function(e) {
        e.preventDefault();
        fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ date: document.getElementById('date').value, amount: document.getElementById('amount').value, category: document.getElementById('category').value, bank: document.getElementById('bank').value, type: document.getElementById('type').value }) }).then(() => { location.reload(); });
    };
</script>
</body>
</html>
